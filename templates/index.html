<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <title>Sistem Temu Kembali</title>
</head>
<style>
    .custom-h {
        max-height: 600px;
    }
</style>

<body>

    <div class="p-4 bg-white drop-shadow-md">
        <p class="text-center font-semibold text-xl">Plagiarism Detector</p>
    </div>

    <section class="m-2 lg:m-5 lg:flex lg:justify-between">
        <form action="#" id="upload-form" enctype="multipart/form-data" class="lg:w-1/2">
            <div class="text-center m-5 px-3 py-5 shadow-md bg-white rounded-md">
                <p class="font-semibold text-lg">
                    Upload Your Files
                </p>
                <span class="text-sm opacity-75 text-red-800">
                    *Upload min 2 file
                </span>
                <label for="file" class="flex justify-center">
                    <div class="border-dashed border-2 border-sky-500 rounded-xl mx-3 my-5 w-full min-h-52">
                        <input type="file" id="file" name="file" multiple hidden />
                        <div class="block text-center items-center p-10">
                            <span class="material-symbols-outlined text-6xl text-sky-500">upload</span>
                            <p class="text-sm font-medium opacity-60">Drag and drop file here</p>
                            <p class="text-sm font-medium opacity-60">or</p>
                            <p class="text-base font-medium text-sky-500 my-3">Browse</p>
                        </div>
                    </div>
                </label>
            </div>

            <div class="m-5 px-3 py-5 shadow-md bg-white rounded-md lg:min-h-52  lg:relative">
                <div class="flex justify-between">
                    <p class="font-medium text-sm">Uploading File</p>
                    <button id="close" class="material-symbols-outlined text-red-700 font-semibold">close</button>
                </div>
                <div class="border-t border-gray-300"></div>
                <div id="wrapper" class="flex gap-3 overflow-x-auto my-3">

                </div>
                <button type="submit"
                    class="lg:absolute lg:inset-x-0 lg:bottom-0 w-full lg:w-11/12 lg:mx-auto my-2 lg:my-5 rounded-lg bg-sky-500 py-3 px-6 text-white text-center text-sm font-semibold uppercase shadow-md shadow-gray-900/10 transition-all hover:shadow-md hover:shadow-gray-900/20 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none">
                    Check Plagiarism
                </button>
            </div>
        </form>

        <div class="m-5 px-3 py-5 shadow-md bg-white rounded-md lg:w-1/2 ">
            <p class="font-medium text-sm">Result Plagiarism</p>
            <div class="border-t border-gray-300"></div>
            <div id="plagiarism" class="mt-3 space-y-3"></div>
        </div>
    </section>

    <script>
        window.addEventListener("DOMContentLoaded", () => {
            const input = document.getElementById("file");
            const wrapper = document.getElementById("wrapper");
            const close = document.getElementById("close");

            close.addEventListener("click", () => {
                wrapper.innerHTML = "";
                input.value = null;
            })

            input.addEventListener("change", () => {
                const files = input.files;
                wrapper.innerHTML = "";
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const fileType = file.type;

                    if (fileType.startsWith('image/')) {
                        const imageUrl = URL.createObjectURL(file);
                        fileShow(file.name, imageUrl);
                    } else {
                        alert("File Harus JPG/PNG/JPEG");
                    }
                }
            });

            const fileShow = (fileName, fileUrl) => {
                const showFile = document.createElement("div");
                showFile.classList.add("w-14", "text-black", "h-14", "bg-white", "shadow-md", "rounded-md", "flex-shrink-0");
                const img = document.createElement("img");
                img.classList.add("w-full", "h-full", "object-cover");
                img.src = fileUrl;
                img.alt = fileName;
                showFile.appendChild(img);
                wrapper.appendChild(showFile);
            };
        });


        document.getElementById('upload-form').addEventListener('submit', function (event) {
            event.preventDefault();
            var formData = new FormData();
            var files = document.getElementById('file').files;
            for (var i = 0; i < files.length; i++) {
                formData.append('file', files[i]);
            }
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    var plagiarismResultDiv = document.getElementById('plagiarism');
                    plagiarismResultDiv.innerHTML = '';
                    if (data.error) {
                        plagiarismResultDiv.innerText = data.error;
                    } else {
                        var similarityResults = data.similarity_results;
                        for (var i = 0; i < similarityResults.length; i++) {
                            if (!similarityResults[i].hasOwnProperty('filename')) {
                                var file1 = similarityResults[i].file1;
                                var file2 = similarityResults[i].file2;
                                var similarity = (similarityResults[i].similarity * 100).toFixed(2);
                                plagiarismResultDiv.innerHTML += '<p>Kesamaan file ' + file1 + ' dan file ' + file2 + ': ' + similarity + '%</p>';
                            }
                        }
                    }
                })
                .catch(error => console.error('Error:', error));
        });


    </script>
</body>

</html>